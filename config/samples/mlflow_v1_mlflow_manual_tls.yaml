apiVersion: mlflow.opendatahub.io/v1
kind: MLflow
metadata:
  name: mlflow
spec:
  # Example with manual TLS certificates (non-OpenShift)
  # Suitable for vanilla Kubernetes environments

  # Kube RBAC Proxy with manual TLS configuration
  kubeRbacProxy:
    enabled: true
    image:
      image: "gcr.io/kubebuilder/kube-rbac-proxy:v0.13.1"
      imagePullPolicy: IfNotPresent
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "100m"
        memory: "256Mi"
    # Manual TLS configuration
    tls:
      secretName: mlflow-tls-manual  # Create this secret manually with tls.crt and tls.key

  # MLflow container image
  image:
    image: quay.io/opendatahub/mlflow:latest
    imagePullPolicy: Always

  # Number of replicas
  replicas: 1

  # Compute resources
  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"
    limits:
      cpu: "1"
      memory: "1Gi"

  # Local file-based storage with PVC
  storage:
    accessModes:
      - ReadWriteOnce
    resources:
      requests:
        storage: 10Gi
    # storageClassName: ""  # Uncomment to specify storage class

  backendStoreUri: "sqlite:////mlflow/mlflow.db"
  registryStoreUri: "sqlite:////mlflow/mlflow.db"
  artifactsDestination: "file:///mlflow/artifacts"

  # IMPORTANT: serveArtifacts MUST be enabled when using file-based artifact storage
  serveArtifacts: true

  # Environment variables
  env:
    - name: MLFLOW_LOGGING_LEVEL
      value: INFO

# Note: Before deploying this example, you need to manually create the TLS secret:
#
# Create the server TLS certificate secret (for kube-rbac-proxy to serve HTTPS):
#    kubectl create secret tls mlflow-tls-manual \
#      --cert=path/to/tls.crt \
#      --key=path/to/tls.key \
#      -n <namespace>
